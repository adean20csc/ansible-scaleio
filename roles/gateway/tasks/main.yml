---
- set_fact: role_name=gateway

- name: Install pre-requisite java
  yum: name="java-1.7.0-openjdk-devel" state="present"

- include: ../../install_scaleio.yml

- name: Add mdm ip's to gateway config
  lineinfile: 
    backup: true
    dest: "{{ gateway_user_properties_file }}" 
    line: "mdm.ip.addresses={{ scaleio_mdm_primary_ip }},{{ scaleio_mdm_secondary_ip }}" 
    regexp: "^mdm.ip.addresses=$" 
    state: present

- name: Setup gateway admin password
  command: > 
    java -jar /opt/emc/scaleio/gateway/webapps/ROOT/resources/install-CLI.jar
    --reset_password "{{ scaleio_gateway_admin_password }}" 
    --config_file {{ gateway_user_properties_file }}
  notify: restart gateway
